import{m as O}from"./assets/module.esm-3267c44a.js";import{b as a}from"./assets/rfc4648-22fd5bf4.js";document.addEventListener("alpine:init",()=>{O.data("webAuthnRegister",function(){const{attestationObjectInput:m,authenticatorLabelInput:g,clientDataJSONInput:A,errorInput:w,publicKeyCredentialIdInput:I,registerForm:s,transportsInput:C}=this.$refs,{attestationConveyancePreference:u,authenticatorAttachment:c,challenge:K,createTimeout:l,excludeCredentialIds:v,requireResidentKey:p,rpEntityName:S,rpId:P,signatureAlgorithms:R,unsupportedBrowserText:x,userId:E,userVerificationRequirement:d,username:f}=this.$store.webAuthnRegister,L=t=>{const e=[];return t===""?(e.push({alg:-7,type:"public-key"}),e):(t.split(",").forEach(i=>{e.push({alg:parseInt(i),type:"public-key"})}),e)},U=t=>{const e=[];return t===""||t.split(",").forEach(i=>{e.push({id:new Uint8Array(a.parse(i,{loose:!0})),type:"public-key"})}),e},q=t=>{if(t===""||t.constructor!==Array)return"";let e="";return t.forEach(r=>{e+=r+","}),e.slice(0,-1)};return{registerSecurityKey:()=>{if(!window.PublicKeyCredential){w.value=x,s.submit();return}const t={challenge:new Uint8Array(a.parse(K,{loose:!0})),pubKeyCredParams:L(R),rp:{id:P,name:S},user:{displayName:f,id:new Uint8Array(a.parse(E,{loose:!0})),name:f}};u!=="not specified"&&(t.attestation=u);const e={};let r=!1;c!=="not specified"&&(e.authenticatorAttachment=c,r=!0),p!=="not specified"&&(p==="Yes"?e.requireResidentKey=!0:e.requireResidentKey=!1,r=!0),d!=="not specified"&&(e.userVerification=d,r=!0),r&&(t.authenticatorSelection=e);const i=U(v);i.length>0&&(t.excludeCredentials=i),parseInt(l)!==0&&(t.timeout=parseInt(l)*1e3),navigator.credentials.create({publicKey:t}).then(n=>{if(n instanceof PublicKeyCredential&&n.response instanceof AuthenticatorAttestationResponse){const{getTransports:y}=n.response;window.result=n;const N=n.rawId;if(m.value=a.stringify(new Uint8Array(n.response.attestationObject),{pad:!1}),A.value=a.stringify(new Uint8Array(n.response.clientDataJSON),{pad:!1}),I.value=a.stringify(new Uint8Array(N),{pad:!1}),typeof y=="function"){const b=y();b&&(C.value=q(b))}else console.log("Your browser is not able to recognize supported transport media for the authenticator.");const h="WebAuthn Authenticator (Default Label)";let o=window.prompt("Please input your registered authenticator's label",h);o===null&&(o=h),g.value=o,s.submit()}}).catch(function(n){n.value=n,s.submit()})}}})});
